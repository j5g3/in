!function(a,b){"use strict";var c=b.navigator.isCocoonJS;a.in=function(b){return new a.in.Listener(b)},a.in.Modules={},a.in.Handler=function(b,c){this.listener=b,a.extend(this,c)},a.in.Handler.prototype={listener:null,remove:function(){this.listener.un(this)}},a.in.Listener=a.Class.extend({x:0,y:0,dx:0,dy:0,bx:0,by:0,sx:1,sy:1,module:null,element:null,interval:null,intervalId:null,handlers:null,auto_scale:!0,minimal:!1,disabled:!1,init:function(d){var e=this;("string"==typeof d||"object"==typeof d&&d.tagName)&&(d={element:d}),a.Class.call(this,d),null===this.element?this.element=b.document:"string"==typeof this.element&&(this.element=a.id(this.element)),e.module={},e.handlers=[],e.poll=function(){e._poll()},e.calculate_bound=function(a){e._calculate_bound(a)},c||(b.addEventListener("resize",this.calculate_bound),b.addEventListener("scroll",this.calculate_bound),this.calculate_bound()),e.interval?e.intervalId=e.setInterval(e.poll,e.interval):(e.poll=function(){e._poll(),b.requestAnimationFrame(e.poll)},b.requestAnimationFrame(e.poll));for(var f in a.in.Modules)e.module[f]=new a.in.Modules[f](e)},suspend:function(a){var c=this;c.disabled=!0,b.setTimeout(function(){c.disabled=!1},a)},on:function(b){var c=new a.in.Handler(this,b);return this.handlers.push(c),c},un:function(a){var b=this.handlers.indexOf(a);this.handlers.splice(b,1)},reset:function(){this.handlers=[],this.interval=a.in.Listener.prototype.interval},fire:function(a,b){if(!this.disabled&&(b.j5g3in=this,b.name=a,(!this.on_fire||this.on_fire(b)!==!1)&&this.handlers))for(var c,d=this.handlers.length;d--;)if(c=this.handlers[d][a],c&&(b.preventDefault(),c(b)===!1))return},_calculate_bound:function(){var a,c=this.element;c.getBoundingClientRect?(a=c.getBoundingClientRect(),this.bx=b.scrollX+(0|a.left)||0,this.by=b.scrollY+(0|a.top)||0):(this.bx=c.clientLeft||0,this.by=c.clientTop||0),this.auto_scale&&c.width&&c.height&&(this.sx=c.width/c.clientWidth,this.sy=c.height/c.clientHeight)},__pollFn:null,_poll:function(){if(this.disabled===!1)for(var a in this.module)this.module[a].update()},set_pos:function(a,b){a=(a-this.bx)*this.sx,b=(b-this.by)*this.sy,this.dx=a-this.x,this.dy=b-this.y,this.x=a,this.y=b},destroy:function(){this.disable(),this.poll=function(){},this.handlers=null,b.removeEventListener("scroll",this.calculate_bound),b.removeEventListener("resize",this.calculate_bound),b.clearInterval(this.intervalId)},enable:function(){this.disabled=!1;for(var a in this.module)this.module[a].enable()},disable:function(){this.disabled=!0;for(var a in this.module)this.module[a].disable()}}),a.in.Module=a.Class.extend({handler:null,el:null,enabled:!1,_enable:null,_disable:null,init:function(a){this.handler={},this.listener=a,this.el=a.element,this.enable(),a.minimal&&this._minimal()},_minimal:function(){this.minimal=!0},update:function(){},_on:function(a,b){var c=b.bind(this);this.handler[a]=c,this.el.addEventListener(a,c)},_un:function(a){this.el.removeEventListener(a,this.handler[a])},enable:function(){return this.enabled||(this._enable(),this.enabled=!0),this},disable:function(){return this.enabled&&(this._disable(),this.enabled=!1),this},destroy:function(){this.disable();for(var a in this.listener.module)if(this.listener.module[a]===this){delete this.listener.module[a];break}}})}(this.j5g3,this),function(a){"use strict";a.in.Modules.Mouse=a.in.Module.extend({x_threshold:1,y_threshold:1,bx:0,by:0,capture_move:!0,_calculate_pos:function(a){this.listener.set_pos(a.pageX,a.pageY)},_click:function(a){var b={0:"buttonY",1:"buttonX",2:"buttonA"}[a.button];return this._calculate_pos(a),this.listener.fire(b,a),this.listener.fire("button",a),!1},_minimal:function(){this.capture_move=!1},_mousemove:function(a){this.capture_move&&(this._calculate_pos(a),(Math.abs(this.listener.dx)>this.x_threshold||Math.abs(this.listener.dy)>this.y_threshold)&&this.listener.fire("move",a))},_enable:function(){this._on("mousemove",this._mousemove),this._on("click",this._click),this._on("contextmenu",this._click)},_disable:function(){this._un("mousemove"),this._un("click"),this._un("contextmenu")}})}(this.j5g3,this),function(a){"use strict";a.in.Modules.Touch=a.in.Module.extend({x_threshold:20,y_threshold:20,flick_threshold:70,flick_delay:200,pivot_x:null,pivot_y:null,touches:null,_move_type:"linear",set move_type(a){this._move_type=a,this.__move="linear"===a?this.__touchmove:this.__touchradial},get move_type(){return this._move_type},radius:25,angle:0,__move:null,init:function(b){a.in.Module.call(this,b),this.move_type=this._move_type},_calculate_pos:function(a){this.listener.set_pos(a.pageX,a.pageY)},each_touch:function(a,b){for(var c,d,e=a.changedTouches,f=e.length;f--;)d=e[f].identifier,c=this.touches[d]||(this.touches[d]={id:d}),c.ev=a,c.touch=e[f],this._calculate_pos(c.touch),b(c,this)},update:function(){if(!this.minimal){var a,b,c=this.touches;for(b in c)a=c[b],a.moved||(this._calculate_pos(a.touch),this.listener.fire("buttonY",a.ev))}},doMove:function(a){a.moved=!0,this.listener.fire(a.direction,a.ev),this.minimal||(a.ev.direction=a.direction,this.listener.fire("move",a.ev))},__touchmove:function(a,b){var c,d=b.listener.x,e=b.listener.y,f=d-a.mx,g=e-a.my;f<-b.x_threshold?(a.mx=d,c="left"):f>b.x_threshold&&(a.mx=d,c="right"),g<-b.y_threshold?(a.my=e,c="up"+(c?"_"+c:"")):g>b.y_threshold&&(a.my=e,c="down"+(c?"_"+c:"")),a.direction=c,c&&b.doMove(a)},__touchradial:function(a,b){var c=b.listener.x,d=b.listener.y,e=a.tx-c,f=a.ty-d,g=c-a.pivotx,h=d-a.pivoty;(e>b.x_threshold||e<-b.x_threshold)&&(f>b.y_threshold||f<-b.y_threshold)&&(b.angle=a.ev.angle=Math.atan2(h,g),b.listener.fire("move",a.ev))},_touchmove:function(a){this.each_touch(a,this.__move)},_flick_action:function(a){var b,c=this.listener.x,d=this.listener.y,e=c-a.tx,f=d-a.ty;e<-this.flick_threshold?b="buttonY":e>this.flick_threshold&&(b="buttonA"),f<-this.flick_threshold?b="buttonX":f>this.flick_threshold&&(b="buttonB"),b?this.listener.fire(b,a.ev):a.direction&&this.doMove(a)},set_pivot:function(a){a.pivotx=this.pivot_x||a.tx-Math.cos(this.angle)*this.radius,a.pivoty=this.pivot_y||a.ty-Math.sin(this.angle)*this.radius},__touchstart:function(a,b){a.start=Date.now(),a.tx=a.mx=b.listener.x,a.ty=a.my=b.listener.y,"radial"===b.move_type&&b.set_pivot(a)},__touchend:function(a,b){var c=Date.now()-a.start;c<b.flick_delay&&b._flick_action(a),delete b.touches[a.id]},_touchstart:function(a){this.each_touch(a,this.__touchstart)},_touchend:function(a){this.each_touch(a,this.__touchend)},_enable:function(){this._on("touchmove",this._touchmove),this._on("touchstart",this._touchstart),this._on("touchend",this._touchend),this.touches={}},_disable:function(){this._un("touchmove"),this._un("touchstart"),this._un("touchend")}})}(this.j5g3,this),function(a,b){"use strict";var c=b.document,d={32:"buttonB",13:"buttonY",16:"buttonX",17:"buttonA",37:"left",38:"up",39:"right",40:"down",105:"up_right",103:"up_left",99:"down_right",97:"down_left"};a.in.Modules.Keyboard=a.in.Module.extend({keymap:null,keys:null,_keydown:function(a){this.keys[a.keyCode]=a,this.keymap[a.keyCode]&&a.preventDefault()},init:function(b){this.keys={},a.in.Module.call(this,b),null===this.keymap&&a.extend(this.keymap={},d)},_keyup:function(a){this.keys[a.keyCode]=!1},update:function(){var a,b,c;for(c in this.keymap)b=this.keys[c],b&&(a=this.keymap[c],this.listener.fire(a,b),c>32&&(b.direction=a,this.listener.fire("move",b)),this.listener.fire("button",b))},_enable:function(){this.keys={},this.handler.keydown=this._keydown.bind(this),this.handler.keyup=this._keyup.bind(this),c.addEventListener("keydown",this.handler.keydown),c.addEventListener("keyup",this.handler.keyup)},_disable:function(){this.keys={},c.removeEventListener("keydown",this.handler.keydown),c.removeEventListener("keyup",this.handler.keyup)}})}(this.j5g3,this),function(a,b){"use strict";b.navigator.webkitGetGamepads&&(a.in.Modules.Joystick=a.in.Module.extend({_enable:function(){},_disable:function(){}}))}(this.j5g3,this);